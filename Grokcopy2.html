<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯†ç ç”Ÿæˆå™¨</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: #333;
        }
        .container {
            text-align: center;
            padding: 30px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            width: 400px;
            max-width: 90%;
        }
        h2 {
            color: #2c3e50;
            margin-bottom: 25px;
        }
        input {
            padding: 12px 15px;
            width: 200px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        input:focus {
            border-color: #6e8efb;
            outline: none;
        }
        button {
            padding: 12px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        #copyButton {
            background-color: #2ecc71;
        }
        #copyButton:hover {
            background-color: #27ae60;
        }
        #copyButton:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .password-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }
        #passwordOutput {
            font-size: 18px;
            color: #2c3e50;
            word-break: break-all;
            margin: 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            flex-grow: 1;
            text-align: center;
            min-height: 20px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        .message {
            margin: 15px 0;
            padding: 10px;
            border-radius: 4px;
            font-weight: 500;
        }
        .error {
            background-color: #ffecec;
            color: #e74c3c;
            border: 1px solid #f5b7b1;
        }
        .success {
            background-color: #eafaf1;
            color: #27ae60;
            border: 1px solid #a3e4d7;
        }
        .instructions {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 25px;
            line-height: 1.5;
        }
        .input-group {
            margin: 20px 0;
        }
        /* æ¸…é™¤æŒ‰é’®æ ·å¼ */
        #clearButton {
            background-color: #e74c3c;
            padding: 12px 15px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            margin-left: 5px;
        }
        #clearButton:hover {
            background-color: #c0392b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ” å¯†ç ç”Ÿæˆå™¨</h2>
        
        <div class="input-group">
            <input type="text" id="inputChars" maxlength="3" placeholder="è¾“å…¥3ä¸ªå­—æ¯æˆ–æ•°å­—"
                   oninput="this.value = this.value.replace(/[^a-zA-Z0-9]/g, '')">
            <button id="clearButton" onclick="clearInput()">æ¸…é™¤</button>
        </div>
        
        <button onclick="generatePassword()">ç”Ÿæˆå¯†ç </button>
        
        <div class="password-container">
            <div id="passwordOutput"></div>
            <button id="copyButton" onclick="copyPassword()" disabled>å¤åˆ¶</button>
        </div>
        
        <div id="errorMessage" class="message error" style="display: none;"></div>
        <div id="successMessage" class="message success" style="display: none;"></div>
        
        <div class="instructions">
            <p>ğŸ’¡ è¾“å…¥ä»»æ„3ä¸ªå­—æ¯æˆ–æ•°å­—ï¼Œç³»ç»Ÿå°†åŸºäºæ­¤ç”Ÿæˆä¸€ä¸ª10å­—ç¬¦çš„å¼ºå¯†ç </p>
            <p>ğŸ“‹ ç‚¹å‡»"å¤åˆ¶"æŒ‰é’®å°†å¯†ç å¤åˆ¶åˆ°å‰ªè´´æ¿</p>
        </div>
    </div>

    <script>
        const charset = {
            letters: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz',
            digits: '0123456789',
            symbols: '?!:<>=&,._-/+*'
        };

        function hashCode(str, salt) {
            let hash = salt;
            for (let i = 0; i < str.length; i++) {
                hash = ((hash * 31) + str.charCodeAt(i)) & 0x7FFFFFFF;
            }
            return hash;
        }

        function generatePassword() {
            try {
                const input = document.getElementById('inputChars').value;
                const output = document.getElementById('passwordOutput');
                const error = document.getElementById('errorMessage');
                const success = document.getElementById('successMessage');
                const copyButton = document.getElementById('copyButton');

                // éšè—æ‰€æœ‰æ¶ˆæ¯
                error.style.display = 'none';
                success.style.display = 'none';

                if (input.length !== 3 || !/^[a-zA-Z0-9]{3}$/.test(input)) {
                    error.textContent = 'è¯·è¾“å…¥æ­£å¥½3ä¸ªå­—æ¯æˆ–æ•°å­—ï¼';
                    error.style.display = 'block';
                    output.textContent = '';
                    copyButton.disabled = true;
                    return;
                }

                const salt = 27;
                let seed = hashCode(input, salt);

                const random = (max) => {
                    const a = 1664525;
                    const c = 1013904223;
                    const m = 2 ** 32;
                    seed = (a * seed + c) % m;
                    return Math.floor(seed / m * max);
                };

                let letters = charset.letters.split('');
                let digits = charset.digits.split('');
                let symbols = charset.symbols.split('');

                let password = [
                    ...Array(4).fill().map(() => letters[random(letters.length)]),
                    ...Array(4).fill().map(() => digits[random(digits.length)]),
                    ...Array(2).fill().map(() => symbols[random(symbols.length)])
                ];

                // Fisher-Yates æ‰“ä¹±ç®—æ³•
                for (let i = password.length - 1; i > 0; i--) {
                    const j = random(i + 1);
                    [password[i], password[j]] = [password[j], password[i]];
                }

                const passwordText = password.join('');
                output.textContent = passwordText;
                copyButton.disabled = false;
                
            } catch (e) {
                console.error('ç”Ÿæˆå¯†ç æ—¶å‡ºé”™:', e);
                document.getElementById('errorMessage').textContent = 'ç”Ÿæˆå¯†ç æ—¶å‡ºé”™ï¼Œè¯·é‡è¯•ï¼';
                document.getElementById('errorMessage').style.display = 'block';
            }
        }

        function copyPassword() {
            const passwordText = document.getElementById('passwordOutput').textContent;
            const error = document.getElementById('errorMessage');
            const success = document.getElementById('successMessage');
            
            // éšè—ä¹‹å‰çš„æ¶ˆæ¯
            error.style.display = 'none';
            success.style.display = 'none';
            
            if (!passwordText) {
                error.textContent = 'æ²¡æœ‰å¯†ç å¯å¤åˆ¶ï¼';
                error.style.display = 'block';
                return;
            }
            
            // ä½¿ç”¨ç°ä»£Clipboard API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(passwordText).then(() => {
                    success.textContent = 'å¯†ç å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼';
                    success.style.display = 'block';
                    
                    // 3ç§’åæ¸…é™¤æˆåŠŸæ¶ˆæ¯
                    setTimeout(() => {
                        success.style.display = 'none';
                    }, 3000);
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    fallbackCopyText(passwordText);
                });
            } else {
                // ä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
                fallbackCopyText(passwordText);
            }
        }
        
        function fallbackCopyText(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            
            // é¿å…å±å¹•é—ªçƒ
            textArea.style.position = "fixed";
            textArea.style.left = "-999999px";
            textArea.style.top = "-999999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            const success = document.getElementById('successMessage');
            const error = document.getElementById('errorMessage');
            
            try {
                const successful = document.execCommand('copy');
                if(successful) {
                    success.textContent = 'å¯†ç å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼';
                    success.style.display = 'block';
                    
                    // 3ç§’åæ¸…é™¤æˆåŠŸæ¶ˆæ¯
                    setTimeout(() => {
                        success.style.display = 'none';
                    }, 3000);
                } else {
                    throw new Error('å¤åˆ¶å‘½ä»¤å¤±è´¥');
                }
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                error.textContent = 'å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¯†ç å¹¶å¤åˆ¶';
                error.style.display = 'block';
            }
            
            document.body.removeChild(textArea);
        }

        // æ–°å¢æ¸…é™¤è¾“å…¥æ¡†å†…å®¹çš„å‡½æ•°
        function clearInput() {
            document.getElementById('inputChars').value = '';
            // æ¸…é™¤åéšè—é”™è¯¯å’ŒæˆåŠŸæ¶ˆæ¯
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            // æ¸…é™¤åç¦ç”¨å¤åˆ¶æŒ‰é’®
            document.getElementById('copyButton').disabled = true;
            // æ¸…é™¤åæ¸…ç©ºå¯†ç è¾“å‡º
            document.getElementById('passwordOutput').textContent = '';
        }
    </script>
</body>
</html>
